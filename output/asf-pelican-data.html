<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASF Pelican data model - Apache Infrastructure Website</title>
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/fontawesome.all.min.css" rel="stylesheet">
<link href="/css/headerlink.css" rel="stylesheet">
<script src="/highlight/highlight.min.js"></script>  </head>
  <body class="d-flex flex-column h-100">
  <main class="flex-shrink-0">
      <div>

<!-- nav bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark" aria-label="Fifth navbar example">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"><img src="/images/feather.png" style="height: 32px;"/> Apache Infrastructure</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarADP" aria-controls="navbarADP" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarADP">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">About</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/team.html">About the team</a></li>
                        <li><a class="dropdown-item" href="/roundtable.html">The Infrastructure Roundtable</a></li>
                        <li><a class="dropdown-item" href="/blog/">The Infrastructure Blog</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/policies.html">Policies</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">Services and Tools</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/services.html">Services and Tools</a></li>
                        <li><a class="dropdown-item" href="https://blocky.apache.org/">Blocky</a></li>
                        <li><a class="dropdown-item" href="https://app.datadoghq.com/account/login?next=%2Finfrastructure">DataDog</a></li>
                        <li><a class="dropdown-item" href="https://whimsy.apache.org/roster/committer/" target="_blank">Committer Search</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">Documentation</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/doc.html">Contribute</a></li>
                        <li><a class="dropdown-item" href="/infra-volunteer.html">Volunteer with Infra</a></li>
                        <li><a class="dropdown-item" href="/how-to-mirror.html">Become an ASF download mirror</a></li>
                        <li><a class="dropdown-item" href="/hosting-external-agent.html">Host a Jenkins or Buildbot agent</a></li>

                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/stats.html">Status</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/contact.html">Contact Us</a>
                </li>
            </ul>
        </div>
    </div>
</nav>    


<!-- page contents -->
<div id="contents">
    <div class="bg-white p-5 rounded">
        <div class="col-sm-8 mx-auto">
          <h1>
              ASF Pelican data model
          </h1>
              <p>In 2019 Infra created ASF-Pelican as a structure and template for projects to use to build their websites, and for the ASF's own website.</p>
<p>In 2024, Infra moved from ASF-Pelican to the ASF <strong>Infrastructure Pelican Action</strong> GitHub Action to perform the same functions without being closely tied to BuildBot. The repository for this GHA is <a href="https//:github.com/apache/infrastructure-actions/tree/main/pelican" target="_blank">github.com/apache/infrastructure-actions/tree/main/pelican</a>.</p>
<p>The material below is <strong>relevant</strong> to the older Pelican build system and the Pelican GitHub Action.</p>
<hr/>
<h2>ASF Data</h2>
<p>If your site includes the <code>asfdata.py</code> plugin, the Pelican site generator reads instructions from it during initialization and creates shared metadata that is available for all pages. It is particularly critical for <strong>ezmd</strong> pages that contain directives.</p>
<p>The <code>pelicanconf.yaml</code> file contains the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">setup</span><span class="o">:</span>
  <span class="n">data</span><span class="o">:</span> <span class="n">asfdata</span><span class="o">.</span><span class="na">yaml</span>
</code></pre></div>

<ul>
<li><code>data</code> is a .yaml file of metadata instructions.</li>
</ul>
<p>Within the plugin there are three kinds of data transformations:</p>
<ol>
<li>Constant key-value pairs.</li>
<li>Specific sequences that are custom code specific to the datasource:</li>
<li>Twitter feed uses the Twitter Recent Tweet API</li>
<li>Blogs reads a Roller Atom feed in XML</li>
<li>ECCN reads export notifications from a .yaml file</li>
<li>Multiple data models derived from a single .yaml or json file:</li>
<li>Committee info, which has Board, Officer, Committee, and Project information</li>
<li>Podling info, which has Incubator podling information</li>
</ol>
<h2>Key value metadata</h2>
<p>These are provided in the <code>ASF_DATA['data']</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># key-value pairs</span>
<span class="nt">code_lines</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">227M</span>
<span class="nt">code_changed</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4.2B</span>
<span class="nt">code_commits</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4.1M</span>
<span class="nt">asf_members</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">820</span>
<span class="c1"># For use as nnn+ or &#39;more than nnn&#39;</span>
<span class="nt">asf_members_rounded</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">800</span>
<span class="nt">asf_committers</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8,100</span>
<span class="nt">asf_contributors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">40,000</span>
<span class="nt">asf_people</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">488,000</span>
<span class="nt">com_initiatives</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">350</span>
<span class="nt">com_projects</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="nt">com_podlings</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">37</span>
<span class="nt">com_downloads</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~2 Petabytes</span>
<span class="nt">com_emails</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">24M</span>
<span class="nt">com_mailinglists</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1,400</span>
<span class="nt">com_pageviews</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">35M</span>
</code></pre></div>

<h2>Recent tweets</h2>
<p>This sequence uses specific code:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># used on index.ezmd</span>
<span class="nt">twitter</span><span class="p">:</span>
  <span class="c1"># load, transform, and create a sequence of tweets</span>
  <span class="nt">handle</span><span class="p">:</span> <span class="s">&#39;TheASF&#39;</span>
  <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div>

<p>The key method for reading recent tweets from the API.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># retrieve the last count recent tweets from the handle.</span>
<span class="k">def</span> <span class="nf">process_twitter</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-----</span><span class="se">\n</span><span class="s1">twitter feed: </span><span class="si">{</span><span class="n">handle</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">bearer_token</span> <span class="o">=</span> <span class="n">twitter_auth</span><span class="p">()</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;from:</span><span class="si">{</span><span class="n">handle</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">tweet_fields</span> <span class="o">=</span> <span class="s1">&#39;tweet.fields=author_id&#39;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://api.twitter.com/2/tweets/search/recent?query=</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">&amp;</span><span class="si">{</span><span class="n">tweet_fields</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">bearer_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
    <span class="n">load</span> <span class="o">=</span> <span class="n">connect_to_endpoint</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">sequence_list</span><span class="p">(</span><span class="s1">&#39;twitter&#39;</span><span class="p">,</span> <span class="n">load</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">load</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;result_count&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">reference</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>

<h2>Recent blog posts</h2>
<p>The main Apache site uses three different blog feeds. Here is how the site calls one, as an example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># used on index.ezmd</span>
<span class="nt">foundation</span><span class="p">:</span>
  <span class="c1"># load, transform, and create a sequence of foundation blogs</span>
  <span class="nt">blog</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://blogs.apache.org/foundation/feed/entries/atom</span>
  <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div>

<p>The site is only interested in the most recent post's title and id/url.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># retrieve blog posts from an Atom feed.</span>
<span class="k">def</span> <span class="nf">process_blog</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;blog feed: </span><span class="si">{</span><span class="n">feed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="c1"># dive into the dom to get &#39;entry&#39; elements</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">)</span>
    <span class="c1"># we only want count many from the beginning</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">tagName</span><span class="p">)</span>
        <span class="c1"># we only want the title and href</span>
        <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">get_element_text</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">),</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">get_element_text</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span> <span class="n">Blog</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                  <span class="n">title</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
             <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span> <span class="p">]</span>
</code></pre></div>

<p>Note the use of the <code>Blog</code> class. Its definition is in the code for the next example.</p>
<h2>ECCN Data Sequences</h2>
<p>The ECCN data matrix is records a project's bisnotice emails regarding encryption code.
It has four layers: projects, products, versions, and controlled sources. This information is primarily of interest to the main Apache site, but may be useful to those working on project websites in showing how the system secures and processes data.</p>
<p>Here are the ASF_DATA directives</p>
<div class="highlight"><pre><span></span><code><span class="c1"># used on licenses/exports/index.ezmd</span>
<span class="nt">eccn</span><span class="p">:</span>
  <span class="c1"># load, transform, and create a four tiered structure of sequence objects</span>
  <span class="c1"># projects, products, versions, and sources</span>
  <span class="nt">file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">data/eccn/eccnmatrix.yaml</span>
</code></pre></div>

<p>Here is a sample of the data for the first project.</p>
<div class="highlight"><pre><span></span><code><span class="nt">eccnmatrix</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">href</span><span class="p">:</span> <span class="s">&#39;http://accumulo.apache.org/&#39;</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Apache Accumulo Project</span>
    <span class="nt">contact</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">John Vines</span>
    <span class="nt">product</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Apache Accumulo Project</span>
        <span class="nt">versions</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">development</span>
            <span class="nt">eccn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5D002</span>
            <span class="nt">source</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">href</span><span class="p">:</span> <span class="s">&#39;https://git-wip-us.apache.org/repos/asf/accumulo.git&#39;</span>
                <span class="nt">manufacturer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ASF</span>
                <span class="nt">why</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Designed for use with built in Java encryption libraries</span>
              <span class="p p-Indicator">-</span> <span class="nt">href</span><span class="p">:</span> <span class="s">&#39;http://www.bouncycastle.org/download/bcmail-jdk15-137.tar.gz&#39;</span>
                <span class="nt">manufacturer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Bouncy Castle</span>
                <span class="nt">why</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">General-purpose encryption library for Java 1.5</span>
          <span class="p p-Indicator">-</span> <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.6.0 and on</span>
            <span class="nt">eccn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5D002</span>
            <span class="nt">source</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">href</span><span class="p">:</span> <span class="s">&#39;https://git-wip-us.apache.org/repos/asf/accumulo.git&#39;</span>
                <span class="nt">manufacturer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ASF</span>
                <span class="nt">why</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Designed for use with built in Java encryption libraries</span>
              <span class="p p-Indicator">-</span> <span class="nt">href</span><span class="p">:</span> <span class="s">&#39;http://www.bouncycastle.org/download/bcmail-jdk15-137.tar.gz&#39;</span>
                <span class="nt">manufacturer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Bouncy Castle</span>
                <span class="nt">why</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">General-purpose encryption library for Java 1.5</span>
          <span class="p p-Indicator">-</span> <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.5.x</span>
            <span class="nt">eccn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5D002</span>
            <span class="nt">source</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">href</span><span class="p">:</span> <span class="s">&#39;https://git-wip-us.apache.org/repos/asf/accumulo.git&#39;</span>
                <span class="nt">manufacturer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ASF</span>
                <span class="nt">why</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Designed for use with built in Java encryption libraries</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>

<p>Here is the custom processing for the ECCN data matrix. Note the wrappers.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># create sequence of sequences of ASF ECCN data.</span>
<span class="k">def</span> <span class="nf">process_eccn</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----</span><span class="se">\n</span><span class="s1">ECCN:&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>

    <span class="c1"># versions have zero or more controlled sources</span>
    <span class="k">def</span> <span class="nf">make_sources</span><span class="p">(</span><span class="n">sources</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span> <span class="n">Source</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                        <span class="n">manufacturer</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;manufacturer&#39;</span><span class="p">],</span>
                        <span class="n">why</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;why&#39;</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sources</span> <span class="p">]</span>

    <span class="c1"># products have one or more versions</span>
    <span class="k">def</span> <span class="nf">make_versions</span><span class="p">(</span><span class="n">vsns</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span> <span class="n">Version</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">],</span>
                         <span class="n">eccn</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;eccn&#39;</span><span class="p">],</span>
                         <span class="n">source</span><span class="o">=</span><span class="n">make_sources</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="p">])),</span>
                         <span class="p">)</span>
                 <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vsns</span><span class="p">,</span>
                                 <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">))</span> <span class="p">]</span>

    <span class="c1"># projects have one or more products</span>
    <span class="k">def</span> <span class="nf">make_products</span><span class="p">(</span><span class="n">prods</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span> <span class="n">Product</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                         <span class="n">versions</span><span class="o">=</span><span class="n">make_versions</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;versions&#39;</span><span class="p">]),</span>
                         <span class="p">)</span>
                 <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">prods</span><span class="p">,</span>
                                 <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="p">]</span>

    <span class="c1"># eccn matrix has one or more projects</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">Project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">proj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                     <span class="n">href</span><span class="o">=</span><span class="n">proj</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span>
                     <span class="n">contact</span><span class="o">=</span><span class="n">proj</span><span class="p">[</span><span class="s1">&#39;contact&#39;</span><span class="p">],</span>
                     <span class="n">product</span><span class="o">=</span><span class="n">make_products</span><span class="p">(</span><span class="n">proj</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">]))</span>
             <span class="k">for</span> <span class="n">proj</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;eccnmatrix&#39;</span><span class="p">],</span>
                                <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="p">]</span>


<span class="c1"># object wrappers</span>
<span class="k">class</span> <span class="nc">wrapper</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

<span class="c1"># Improve the names when failures occur.</span>
<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">wrapper</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Version</span><span class="p">(</span><span class="n">wrapper</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">wrapper</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">wrapper</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">wrapper</span><span class="p">):</span> <span class="k">pass</span>
</code></pre></div>

<h2>Committee Info</h2>
<p>The committee info data contains three data structures: - officers, committees, and the board of directors. Again, this is primarily of interest to the main Apache site.</p>
<p>From these we derive:</p>
<ul>
<li>Board of Directors sequence</li>
<li>Officers sequence</li>
<li>Committees / PMCs sequence</li>
<li>CI - Officers including PMC VPs dictionary</li>
<li>Projects sequence</li>
<li>Featured projects - a random sample of three projects.</li>
<li>Project directory columns</li>
</ul>
<h3>Board of Directors</h3>
<p>The Board of Directors sequence is derived first.</p>
<div class="highlight"><pre><span></span><code>  <span class="err">...</span>
  <span class="s2">&quot;board&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;roster&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;bdelacretaz&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bertrand Delacretaz&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;fielding&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Roy T. Fielding&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;sharan&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sharan Foga&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;jmclean&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Justin Mclean&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;rubys&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sam Ruby&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;clr&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Craig L Russell&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;rvs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Roman Shaposhnik&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;striker&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sander Striker&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;wusheng&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sheng Wu&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="err">...</span>
</code></pre></div>

<p>Here are the directives</p>
<div class="highlight"><pre><span></span><code><span class="nt">ci</span><span class="p">:</span>
  <span class="c1"># load, transform, and create data sequences from committee info </span>
  <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://whimsy.apache.org/public/committee-info.json</span>
  <span class="nt">board</span><span class="p">:</span>
    <span class="c1"># used on /foundation/ and /foundation/board/</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;Board</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">Directors</span><span class="nv"> </span><span class="s">sequence&#39;</span>
    <span class="c1"># select ci[&#39;board&#39;][&#39;roster&#39;] for the sequence</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">board.roster</span>
</code></pre></div>

<p>Here is the Python code used to select the board roster from committee info.</p>
<div class="highlight"><pre><span></span><code>    <span class="c1"># select sub dictionary</span>
    <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;path: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
</code></pre></div>

<p>The following procedure converts a dictionary into a sequence of objects with attributes.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># convert a dictionary into a sequence (list)</span>
<span class="k">def</span> <span class="nf">sequence_dict</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">reference</span><span class="p">):</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
        <span class="c1"># converting dicts into objects with attributes. Ignore non-dict content.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># put the key of the dict  into the dictionary</span>
            <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="s1">&#39;key_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refs</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="n">item</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="c1"># fix up any Boolean values to be ezt.boolean - essentially True -&gt; &quot;yes&quot;</span>
                    <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">ezt</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
            <span class="c1"># convert the dict into an object with attributes and append to the sequence</span>
            <span class="n">sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="p">(),</span> <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">sequence</span>
</code></pre></div>

<h3>Officers</h3>
<p>How the system assembles the list of Foundation officers.</p>
<div class="highlight"><pre><span></span><code>    <span class="s2">&quot;boardchair&quot;</span><span class="err">:</span> <span class="p">{</span>
      <span class="nt">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Board Chair&quot;</span><span class="p">,</span>
      <span class="nt">&quot;paragraph&quot;</span><span class="p">:</span> <span class="s2">&quot;Executive Officers&quot;</span><span class="p">,</span>
      <span class="nt">&quot;roster&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;striker&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sander Striker&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span><span class="err">,</span>
</code></pre></div>

<p>Committees / PMC Chairs. Roster and Reporting is omitted.</p>
<div class="highlight"><pre><span></span><code>    <span class="err">...</span>
    <span class="s2">&quot;zookeeper&quot;</span><span class="err">:</span> <span class="p">{</span>
      <span class="nt">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ZooKeeper&quot;</span><span class="p">,</span>
      <span class="nt">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;http://zookeeper.apache.org/&quot;</span><span class="p">,</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Centralized service for maintaining configuration information&quot;</span><span class="p">,</span>
      <span class="nt">&quot;mail_list&quot;</span><span class="p">:</span> <span class="s2">&quot;zookeeper&quot;</span><span class="p">,</span>
      <span class="nt">&quot;established&quot;</span><span class="p">:</span> <span class="s2">&quot;11/2010&quot;</span><span class="p">,</span>
      <span class="nt">&quot;chair&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;fpj&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Flavio Junqueira&quot;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;pmc&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span><span class="err">,</span>
    <span class="s2">&quot;legal&quot;</span><span class="err">:</span> <span class="p">{</span>
      <span class="nt">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Legal Affairs&quot;</span><span class="p">,</span>
      <span class="nt">&quot;site&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&quot;mail_list&quot;</span><span class="p">:</span> <span class="s2">&quot;legal&quot;</span><span class="p">,</span>
      <span class="nt">&quot;established&quot;</span><span class="p">:</span> <span class="s2">&quot;03/2007&quot;</span><span class="p">,</span>
      <span class="nt">&quot;chair&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;rvs&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Roman Shaposhnik&quot;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;pmc&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&quot;paragraph&quot;</span><span class="p">:</span> <span class="s2">&quot;Board Committees&quot;</span>
    <span class="p">}</span><span class="err">,</span>
    <span class="err">...</span>
</code></pre></div>

<p>Here are the directives that create metadata models from the above data.</p>
<div class="highlight"><pre><span></span><code>  <span class="nt">officers</span><span class="p">:</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;Foundation</span><span class="nv"> </span><span class="s">Officers</span><span class="nv"> </span><span class="s">sequence&#39;</span>
    <span class="c1"># select ci[&#39;officers&#39;] for the sequence</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">officers</span>
    <span class="c1"># convert ci[&#39;officers&#39;][&#39;roster&#39;]</span>
    <span class="nt">asfid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">roster</span>
  <span class="nt">committees</span><span class="p">:</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;Foundation</span><span class="nv"> </span><span class="s">Committees</span><span class="nv"> </span><span class="s">sequence&#39;</span>
    <span class="c1"># ci[&#39;committees&#39;]</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">committees</span>
    <span class="c1"># remove all report and roster dictionaries from committees</span>
    <span class="nt">trim</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">report,roster</span>
    <span class="c1"># convert ci[&#39;committees&#39;][&#39;chair&#39;]</span>
    <span class="nt">asfid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chair</span>
  <span class="nt">ci</span><span class="p">:</span>
    <span class="c1"># used on /foundation/</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;Dictionary</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">officers</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">committees&#39;</span>
    <span class="c1"># save a merged dictionary version of these sequences.</span>
    <span class="nt">dictionary</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">officers,committees</span>
</code></pre></div>

<p>We've already seen the code for <code>path</code> above. Here is the code that invokes <code>trim</code> and <code>asfid</code>:</p>
<div class="highlight"><pre><span></span><code>    <span class="c1"># remove irrelevant keys</span>
    <span class="k">if</span> <span class="s1">&#39;trim&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;trim: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;trim&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;trim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">remove_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>

    <span class="c1"># transform roster and chair patterns</span>
    <span class="k">if</span> <span class="s1">&#39;asfid&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;asfid: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;asfid&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">asfid_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;asfid&#39;</span><span class="p">])</span>
</code></pre></div>

<p>Here is the code that trims a key from a dictionary:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># remove parts of a data source we don&#39;t want ro access</span>
<span class="k">def</span> <span class="nf">remove_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">refs</span> <span class="o">==</span> <span class="n">part</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">reference</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">remove_part</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">],</span> <span class="n">part</span><span class="p">)</span>
</code></pre></div>

<p>Here is the code that rearranges the chair or officer (roster) so that the dictionary is flattened before sequencing.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># rotate a roster list singleton into an name and availid </span>
<span class="k">def</span> <span class="nf">asfid_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
        <span class="n">fix</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="n">part</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fix</span><span class="p">:</span>
            <span class="n">availid</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">fix</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="s1">&#39;availid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">availid</span>
</code></pre></div>

<p>The <code>ci</code> data model is a dictionary we need to improve the display of officers on the ASF main site.</p>
<div class="highlight"><pre><span></span><code>    <span class="c1"># this dictionary is derived from sub-dictionaries</span>
    <span class="k">if</span> <span class="s1">&#39;dictionary&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dictionary: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;dictionary&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;dictionary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="c1"># create a dictionary from the keys in one or more sub-dictionaries</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">load</span><span class="p">[</span><span class="n">path</span><span class="p">]:</span>
                <span class="n">reference</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">load</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="c1"># dictionary result, do not sequence</span>
        <span class="n">is_dictionary</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>

<h3>Projects / PMCs</h3>
<p>For sequences about projects we first derive a project list from the committee list. We supplement it with each project's initial letter to provide an alphabetical project index. </p>
<div class="highlight"><pre><span></span><code>  <span class="nt">projects</span><span class="p">:</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;Current</span><span class="nv"> </span><span class="s">Projects&#39;</span>
    <span class="c1"># ci[&#39;committees&#39;]</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">committees</span>
    <span class="c1"># select only where &#39;pmc&#39; is true.</span>
    <span class="nt">where</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pmc</span>
    <span class="c1"># sort by project name</span>
    <span class="nt">alpha</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">display_name</span>
</code></pre></div>

<p>Here's the code that trims non-pmcs from the committee list.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># trim out parts of a data source that don&#39;t match part = True</span>
<span class="k">def</span> <span class="nf">where_parts</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
    <span class="c1"># currently only works on True parts</span>
    <span class="c1"># if we trim as we go we invalidate the iterator. Instead create a deletion list.</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
    <span class="c1"># first find the list that needs to be trimmed.</span>
    <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="n">part</span><span class="p">]:</span>
            <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span>
    <span class="c1"># remove the parts to be trimmed.</span>
    <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">filtered</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">]</span>
</code></pre></div>

<p>This code provides an alphabetical index for the product index derived below.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># perform alphabetation. HTTP Server is special and is put before &#39;A&#39;</span>
<span class="k">def</span> <span class="nf">alpha_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="n">part</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;HTTP Server&#39;</span><span class="p">:</span>
            <span class="c1"># when sorting by letter HTTPD Server is wanted first</span>
            <span class="n">letter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">letter</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">reference</span><span class="p">[</span><span class="n">refs</span><span class="p">][</span><span class="s1">&#39;letter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">letter</span>
</code></pre></div>

<h3>Featured projects</h3>
<p>On the front page on the main ASF site we feature a random sample of projects. We also want to display a project's logo.</p>
<div class="highlight"><pre><span></span><code>  <span class="nt">featured_projs</span><span class="p">:</span>
    <span class="c1"># used on /</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;Featured</span><span class="nv"> </span><span class="s">Projects&#39;</span>
    <span class="c1"># base on projects sequence</span>
    <span class="nt">sequence</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">projects</span>
    <span class="c1"># take a random sample of 3</span>
    <span class="nt">random</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
    <span class="c1"># logo path - use apache powered by if missing</span>
    <span class="nt">logo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/logos/res/{}/default.png,/foundation/press/kit/poweredBy/Apache_PoweredBy.svg</span>
</code></pre></div>

<p>Here is the code to copy a sequence, take a random sample, add the logo (or the ASF feather if there is no product logo), and, for featured podlings, adjust the name:</p>
<div class="highlight"><pre><span></span><code>    <span class="c1"># this sequence is derived from another sequence</span>
    <span class="k">if</span> <span class="s1">&#39;sequence&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sequence: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;sequence&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]]</span>
        <span class="c1"># sequences derived from prior sequences do not need to be converted to a sequence</span>
        <span class="n">is_sequence</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># this sequence is a random sample of another sequence</span>
    <span class="k">if</span> <span class="s1">&#39;random&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;random: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_sequence</span><span class="p">:</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1"> - random requires an existing sequence to sample&#39;</span><span class="p">)</span>

    <span class="c1"># for a project or podling see if the logo exists w/HEAD and set the relative path.</span>
    <span class="k">if</span> <span class="s1">&#39;logo&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;logo: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;logo&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_sequence</span><span class="p">:</span>
            <span class="c1"># determine the project or podling logo</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="n">add_logo</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;logo&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="s1">&#39;featured_pods&#39;</span><span class="p">:</span>
                <span class="c1"># for podlings strip &quot;Apache&quot; from the beginning and &quot;(incubating)&quot; from the end.</span>
                <span class="c1"># this is Sally&#39;s request</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1"> - logo requires an existing sequence&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Here is the detailed check to see if a project or podling logo is available.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># add logo attribute with HEAD check for existence. If nonexistent use default.</span>
<span class="k">def</span> <span class="nf">add_logo</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
    <span class="c1"># split between logo pattern and default.</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
        <span class="c1"># the logo pattern includes a place to insert the project/podling key</span>
        <span class="n">logo</span> <span class="o">=</span> <span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">key_id</span><span class="p">))</span>
        <span class="c1"># HEAD request</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s1">&#39;https://www.apache.org/&#39;</span> <span class="o">+</span> <span class="n">logo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># logo not found - use the default logo</span>
            <span class="n">logo</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># save the logo path as an attribute</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;logo&#39;</span><span class="p">,</span> <span class="n">logo</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reference</span>
</code></pre></div>

<h3>Project index</h3>
<p>At the bottom of the main page of the ASF site we display a project index that includes headings for each letter of the alphabet:</p>
<div class="highlight"><pre><span></span><code>  <span class="nt">pl</span><span class="p">:</span>
    <span class="c1"># used on /</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&#39;Project</span><span class="nv"> </span><span class="s">List</span><span class="nv"> </span><span class="s">Columns&#39;</span>
    <span class="c1"># base on projects sequence</span>
    <span class="nt">sequence</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">projects</span>
    <span class="c1"># split into 6 column sequence adding letters of the alphabet and putting httpd first</span>
    <span class="nt">split</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
</code></pre></div>

<p>This code derives the sequences for the six columns in the display. The output metadata is <code>pl_0</code>, <code>pl_1</code>, <code>pl_2</code>, <code>pl_3</code>, <code>pl_4</code>, and <code>pl_5</code>: </p>
<div class="highlight"><pre><span></span><code><span class="c1"># split a list into equal sized columns. Adds letter breaks in the alphabetical sequence.</span>
<span class="k">def</span> <span class="nf">split_list</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">split</span><span class="p">):</span>
    <span class="c1"># copy sequence</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
    <span class="c1"># sort the copy</span>
    <span class="n">sequence</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">letter</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">display_name</span><span class="p">))</span>
    <span class="c1"># size of list</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="c1"># size of columns</span>
    <span class="n">percol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">size</span><span class="o">+</span><span class="mi">26</span><span class="o">+</span><span class="n">split</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">split</span><span class="p">)</span>
    <span class="c1"># positions</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">nseq</span> <span class="o">=</span> <span class="n">nrow</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">letter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
    <span class="c1"># create each column</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">split</span><span class="p">):</span>
        <span class="n">subsequence</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mi">26</span><span class="p">,</span> <span class="n">start</span><span class="o">+</span><span class="n">percol</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">nrow</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">letter</span> <span class="o">&lt;</span> <span class="n">sequence</span><span class="p">[</span><span class="n">nseq</span><span class="p">]</span><span class="o">.</span><span class="n">letter</span><span class="p">:</span>
                <span class="c1"># new letter - add a letter break into the column. If a letter has no content it is skipped</span>
                <span class="n">letter</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">nseq</span><span class="p">]</span><span class="o">.</span><span class="n">letter</span>
                <span class="n">subsequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span> <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="n">letter</span><span class="p">,</span> <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="n">letter</span> <span class="p">}))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># add the project into the sequence</span>
                <span class="n">subsequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">nseq</span><span class="p">])</span>
                <span class="n">nseq</span> <span class="o">=</span> <span class="n">nseq</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">nrow</span> <span class="o">=</span> <span class="n">nrow</span><span class="o">+</span><span class="mi">1</span>
        <span class="c1"># save the column sequence in the metadata</span>
        <span class="n">metadata</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subsequence</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
    <span class="k">if</span> <span class="n">nseq</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;WARNING: </span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1"> not all of sequence consumed: short </span><span class="si">{</span><span class="n">size</span><span class="o">-</span><span class="n">nseq</span><span class="si">}</span><span class="s1"> projects&#39;</span><span class="p">)</span>
</code></pre></div>

<h2>Adding a data source</h2>
<p>Before you code to add a data source, evaluate which of the above patterns it fits.</p>
<ul>
<li>Is it a custom pattern as for Twitter, blogs, and ECCN?</li>
<li>Can it follow the sequence of directives used for committee iInfo?</li>
<li>If it is a sequence of directives, does it need a new one?</li>
</ul>
<h3>Adding a custom data source</h3>
<div class="highlight"><pre><span></span><code>    <span class="c1"># Lift data from ASF_DATA[&#39;data&#39;] into METADATA</span>
    <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">asf_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing </span><span class="si">{</span><span class="n">asf_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="n">read_config</span><span class="p">(</span><span class="n">asf_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">:</span>
            <span class="c1"># first check for data that is a singleton with special handling</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;eccn&#39;</span><span class="p">:</span>
                <span class="c1"># process eccn data</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
                <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">=</span> <span class="n">process_eccn</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ECCN V:&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;twitter&#39;</span><span class="p">:</span>
                <span class="c1"># process twitter data</span>
                <span class="c1"># if we decide to have multiple twitter feeds available then move next to blog below</span>
                <span class="n">handle</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;handle&#39;</span><span class="p">]</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
                <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">=</span> <span class="n">process_twitter</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TWITTER V:&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">continue</span>
</code></pre></div>

<p>For a custom singletons add your call to your new process_X code here, following the pattern for ECCN or Twitter.</p>
<div class="highlight"><pre><span></span><code>            <span class="n">value</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># dictionaries may have multiple data structures that are processed with a sequence of actions</span>
                <span class="c1"># into multiple sequences and dictionaries.</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-----</span><span class="se">\n</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> creates one or more sequences&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="c1"># special cases that are multiple are processed first</span>
                <span class="k">if</span> <span class="s1">&#39;blog&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="c1"># process blog feed</span>
                    <span class="n">feed</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;blog&#39;</span><span class="p">]</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
                    <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">=</span> <span class="n">process_blog</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BLOG V:&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                    <span class="k">continue</span>
</code></pre></div>

<p>For custom non-singletons add your call to your new process_X code here, following the pattern for a blog feed.</p>
<h3>Adding a directive to the sequence process</h3>
<p>If you are adding a directive, add it to <code>process_sequence</code> in the place you need it (process order can matter):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># process sequencing transformations to the data source</span>
<span class="k">def</span> <span class="nf">process_sequence</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">load</span>
    <span class="c1"># has been converted to a sequence</span>
    <span class="n">is_sequence</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># has been converted to a dictionary - won&#39;t be made into a sequence</span>
    <span class="n">is_dictionary</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># save metadata at the end</span>
    <span class="n">save_metadata</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># description</span>
    <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># select sub dictionary</span>
    <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;path: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>

    <span class="c1"># filter dictionary by attribute value. if filter is false discard</span>
    <span class="k">if</span> <span class="s1">&#39;where&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;where: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">where_parts</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">])</span>

    <span class="c1"># remove irrelevant keys</span>
    <span class="k">if</span> <span class="s1">&#39;trim&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;trim: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;trim&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;trim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">remove_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>

    <span class="c1"># transform roster and chair patterns</span>
    <span class="k">if</span> <span class="s1">&#39;asfid&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;asfid: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;asfid&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">asfid_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;asfid&#39;</span><span class="p">])</span>

    <span class="c1"># add first letter of alphabetic categories</span>
    <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;alpha: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">alpha_part</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>

    <span class="c1"># this dictionary is derived from sub-dictionaries</span>
    <span class="k">if</span> <span class="s1">&#39;dictionary&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dictionary: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;dictionary&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;dictionary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="c1"># create a dictionary from the keys in one or more sub-dictionaries</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">load</span><span class="p">[</span><span class="n">path</span><span class="p">]:</span>
                <span class="n">reference</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">load</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="c1"># dictionary result, do not sequence</span>
        <span class="n">is_dictionary</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># this sequence is derived from another sequence</span>
    <span class="k">if</span> <span class="s1">&#39;sequence&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sequence: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;sequence&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]]</span>
        <span class="c1"># sequences derived from prior sequences do not need to be converted to a sequence</span>
        <span class="n">is_sequence</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># this sequence is a random sample of another sequence</span>
    <span class="k">if</span> <span class="s1">&#39;random&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;random: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_sequence</span><span class="p">:</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1"> - random requires an existing sequence to sample&#39;</span><span class="p">)</span>

    <span class="c1"># for a project or podling see if the logo exists w/HEAD and set the relative path.</span>
    <span class="k">if</span> <span class="s1">&#39;logo&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;logo: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;logo&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_sequence</span><span class="p">:</span>
            <span class="c1"># determine the project or podling logo</span>
            <span class="n">reference</span> <span class="o">=</span> <span class="n">add_logo</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;logo&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="s1">&#39;featured_pods&#39;</span><span class="p">:</span>
                <span class="c1"># for podlings strip &quot;Apache&quot; from the beginning and &quot;(incubating)&quot; from the end.</span>
                <span class="c1"># this is Sally&#39;s request</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1"> - logo requires an existing sequence&#39;</span><span class="p">)</span>

    <span class="c1"># this sequence is a sorted list divided into multiple columns</span>
    <span class="k">if</span> <span class="s1">&#39;split&#39;</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;split: </span><span class="si">{</span><span class="n">sequence</span><span class="p">[</span><span class="s2">&quot;split&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_sequence</span><span class="p">:</span>
            <span class="c1"># create a sequence for each column</span>
            <span class="n">split_list</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">sequence</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">])</span>
            <span class="c1"># created column sequences are already saved to metadata so do not do so later</span>
            <span class="n">save_metadata</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s1"> - split requires an existing sequence to split&#39;</span><span class="p">)</span>
</code></pre></div>
        </div>
      </div>
    </div>    
    <!-- footer -->
    <div class="row">
      <div class="large-12 medium-12 columns">
        <p style="font-style: italic; font-size: 0.8rem; text-align: center;">
          Copyright 2024, <a href="https://www.apache.org/">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
          Apache&reg; and the Apache feather logo are trademarks of The Apache Software Foundation.
        </p>
      </div>
    </div>
    <script type="application/ecmascript" src="/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"></script>      </div>
  </main>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
